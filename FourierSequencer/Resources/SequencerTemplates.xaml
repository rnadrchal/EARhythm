<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:models="clr-namespace:FourierSequencer.Models"
                    xmlns:syncfusion="http://schemas.syncfusion.com/wpf"
                    xmlns:converters="clr-namespace:Egami.Sequencer.UI.Converters;assembly=Egami.Sequencer.UI"
                    xmlns:wpf="clr-namespace:Material.Icons.WPF;assembly=Material.Icons.WPF">
    <converters:BooleanToBrushConverter x:Key="BooleanToBrush" />
    <converters:BooleanToOpacityConverter x:Key="BooleanToOpacity" />
    <converters:AddConverter x:Key="Add" />

    <DataTemplate DataType="{x:Type models:FourierCoeffizients}">
        <GroupBox Margin="2">
            <GroupBox.Header>
                <TextBlock>
                    <Run Text="Frequency" />
                    <Run Text="{Binding Number, Mode=OneWay}" />
                </TextBlock>
            </GroupBox.Header>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <syncfusion:SfRadialSlider Grid.Row="0" Grid.Column="0"  Width="60" Height="60"
                                           Minimum="-1" Maximum="1"
                                           Value="{Binding A, Mode=TwoWay}"
                                           OuterRimRadiusFactor="0.6"
                                           OuterRimStroke="#444"
                                           OuterRimStrokeThickness="3"
                                           InnerRimFill="#444"
                                           InnerRimStroke="#444"
                                           InnerRimRadiusFactor="0.4"
                                           StartAngle="135" EndAngle="405"
                                           TickFrequency="1"
                                           TickVisibility="Visible"
                                           TickRadiusFactor="0.6" PointerRadiusFactor="0.5" 
                                           LabelVisibility="Hidden">
                    <TextBlock Text="{Binding A, Mode=OneWay}" />
                </syncfusion:SfRadialSlider>

                <TextBlock Grid.Column="0" Grid.Row="1" Text="A" 
                           Style="{StaticResource RadialSliderLabel}"/>

                <syncfusion:SfRadialSlider Grid.Row="0" Grid.Column="1"  Width="60" Height="60"
                                           Minimum="-1" Maximum="1"
                                           Value="{Binding B, Mode=TwoWay}"
                                           OuterRimRadiusFactor="0.6"
                                           OuterRimStroke="#444"
                                           OuterRimStrokeThickness="3"
                                           InnerRimFill="#444"
                                           InnerRimStroke="#444"
                                           InnerRimRadiusFactor="0.4"
                                           StartAngle="135" EndAngle="405"
                                           TickFrequency="1"
                                           TickVisibility="Visible"
                                           TickRadiusFactor="0.6" PointerRadiusFactor="0.5" 
                                           LabelVisibility="Hidden">
                    <TextBlock Text="{Binding B, Mode=OneWay}" />
                </syncfusion:SfRadialSlider>

                <TextBlock Grid.Column="1" Grid.Row="1" Text="B" 
                           Style="{StaticResource RadialSliderLabel}"/>
            </Grid>
        </GroupBox>
    </DataTemplate>
    
    <DataTemplate DataType="{x:Type models:FourierSequencerModel}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="400" />
                <RowDefinition />
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition />
            </Grid.ColumnDefinitions>

            <Grid Grid.Column="0" Grid.RowSpan="2">

                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition />
                </Grid.RowDefinitions>

                <GroupBox Grid.Row="0" Header="Sync" Margin="2">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>
                        <Ellipse Style="{StaticResource LedEllipseStyle}"
                                 Opacity="{Binding LedBeat, Converter={StaticResource BooleanToOpacity}}"
                                 Margin="0,0,0,-6"/>

                        <syncfusion:SfRadialSlider Grid.Row="1"  Width="80" Height="80"
                                                   Minimum="0" Maximum="15"
                                                   Value="{Binding Channel, Mode=TwoWay}"
                                                   OuterRimRadiusFactor="0.6"
                                                   OuterRimStroke="#444"
                                                   OuterRimStrokeThickness="3"
                                                   InnerRimFill="#444"
                                                   InnerRimStroke="#444"
                                                   InnerRimRadiusFactor="0.4"
                                                   StartAngle="135" EndAngle="405"
                                                   TickFrequency="1"
                                                   TickVisibility="Visible"
                                                   TickRadiusFactor="0.6" PointerRadiusFactor="0.5" 
                                                   LabelVisibility="Hidden">
                            <TextBlock Text="{Binding Channel, Mode=OneWay, Converter={StaticResource Add}, ConverterParameter=1}" />
                        </syncfusion:SfRadialSlider>

                        <TextBlock Grid.Row="2" Text="Channel" 
                                   Style="{StaticResource RadialSliderLabel}"/>


                        <syncfusion:SfRadialSlider Grid.Row="3"  Width="80" Height="80"
                                                   Minimum="1" Maximum="96"
                                                   Value="{Binding Divider, Mode=TwoWay}"
                                                   OuterRimRadiusFactor="0.6"
                                                   OuterRimStroke="#444"
                                                   OuterRimStrokeThickness="3"
                                                   InnerRimFill="#444"
                                                   InnerRimStroke="#444"
                                                   InnerRimRadiusFactor="0.4"
                                                   StartAngle="135" EndAngle="405"
                                                   TickFrequency="16"
                                                   TickVisibility="Visible"
                                                   TickRadiusFactor="0.6" PointerRadiusFactor="0.5" 
                                                   LabelVisibility="Hidden">
                            <TextBlock Text="{Binding Divider, Mode=OneWay}" />
                        </syncfusion:SfRadialSlider>

                        <TextBlock Grid.Row="4" Text="Divider" 
                                   Style="{StaticResource RadialSliderLabel}"/>

                        <Button Grid.Row="5" Style="{StaticResource Round3DButton}"
                                Margin="0,16,0,4"
                                Command="{Binding ToggleLegatoCommand}">
                            <wpf:MaterialIcon Kind="Circle" Foreground="LightGreen"
                                              Height="16"
                                              Opacity="{Binding Legato, Converter={StaticResource BooleanToOpacity}}"/>
                        </Button>
                        <TextBlock Grid.Row="6" Text="Legato" 
                                   Style="{StaticResource LabelStyle}"
                                   Margin="2"/>


                    </Grid>
                </GroupBox>

                <GroupBox Grid.Row="1" Header="Steps" Margin="2">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <syncfusion:SfRadialSlider Grid.Row="0"  Width="80" Height="80"
                                                   Minimum="4" Maximum="128"
                                                   Value="{Binding Steps, Mode=TwoWay}"
                                                   OuterRimRadiusFactor="0.6"
                                                   OuterRimStroke="#444"
                                                   OuterRimStrokeThickness="3"
                                                   InnerRimFill="#444"
                                                   InnerRimStroke="#444"
                                                   InnerRimRadiusFactor="0.4"
                                                   StartAngle="135" EndAngle="405"
                                                   TickFrequency="16"
                                                   TickVisibility="Visible"
                                                   TickRadiusFactor="0.6" PointerRadiusFactor="0.5" 
                                                   LabelVisibility="Hidden">
                            <TextBlock Text="{Binding Steps, Mode=OneWay}" />
                        </syncfusion:SfRadialSlider>

                        <TextBlock Grid.Row="1" Text="Steps" 
                                   Style="{StaticResource RadialSliderLabel}"/>

                        <syncfusion:SfRadialSlider Grid.Row="2"  Width="80" Height="80"
                                                   Minimum="0" Maximum="1"
                                                   Value="{Binding StepOffset, Mode=TwoWay}"
                                                   OuterRimRadiusFactor="0.6"
                                                   OuterRimStroke="#444"
                                                   OuterRimStrokeThickness="3"
                                                   InnerRimFill="#444"
                                                   InnerRimStroke="#444"
                                                   InnerRimRadiusFactor="0.4"
                                                   StartAngle="135" EndAngle="405"
                                                   TickVisibility="Hidden"
                                                   TickRadiusFactor="0.6" PointerRadiusFactor="0.5" 
                                                   LabelVisibility="Hidden">
                            <TextBlock Text="{Binding StepOffset, Mode=OneWay}" />
                        </syncfusion:SfRadialSlider>
                        <TextBlock Grid.Row="3" Text="Offset" 
                                   Style="{StaticResource RadialSliderLabel}"/>

                        <syncfusion:SfRadialSlider Grid.Row="4"  Width="80" Height="80"
                                                   Minimum="0" Maximum="65"
                                                   Value="{Binding PointsPerStep, Mode=TwoWay}"
                                                   OuterRimRadiusFactor="0.6"
                                                   OuterRimStroke="#444"
                                                   OuterRimStrokeThickness="3"
                                                   InnerRimFill="#444"
                                                   InnerRimStroke="#444"
                                                   InnerRimRadiusFactor="0.4"
                                                   StartAngle="135" EndAngle="405"
                                                   TickFrequency="8"
                                                   TickVisibility="Visible"
                                                   TickRadiusFactor="0.6" PointerRadiusFactor="0.5" 
                                                   LabelVisibility="Hidden">
                            <TextBlock Text="{Binding PointsPerStep, Mode=OneWay}" />
                        </syncfusion:SfRadialSlider>
                        <TextBlock Grid.Row="5" Text="Points / Step" 
                                   Style="{StaticResource RadialSliderLabel}"/>
                    </Grid>
                </GroupBox>
            </Grid>

            <syncfusion:SfChart x:Name="FourierChart" Grid.Row="0" Grid.Column="1" Margin="10">
                <syncfusion:SfChart.PrimaryAxis>
                    <syncfusion:NumericalAxis Minimum="0" Maximum="{Binding Steps}" />
                </syncfusion:SfChart.PrimaryAxis>

                <!-- declare the chart's SecondaryAxis as the MIDI axis fixed to0..127 -->
                <syncfusion:SfChart.SecondaryAxis>
                    <syncfusion:NumericalAxis Minimum="0" Maximum="127" />
                </syncfusion:SfChart.SecondaryAxis>

                <!-- kontinuierliche Kurve (primary axis) -->
                <syncfusion:LineSeries
                    ItemsSource="{Binding CurvePoints}"
                    XBindingPath="X"
                    YBindingPath="Y"
                    Stroke="Black"
                    StrokeThickness="1.5" />

                <!-- diskrete Step‑Punkte auf der Kurve (fractional positions) mapped to MIDI axis -->
                <syncfusion:ScatterSeries
                    ItemsSource="{Binding StepPoints}"
                    XBindingPath="X"
                    YBindingPath="Y"
                    YAxis="{Binding ElementName=FourierChart, Path=SecondaryAxis}"
                    Stroke="Red" 
                    ScatterHeight="10"
                    ScatterWidth="10" />

                <!-- threshold lines (use MIDI axis) -->
                <syncfusion:LineSeries ItemsSource="{Binding ThresholdLowerLine}" XBindingPath="X" YBindingPath="Y" YAxis="{Binding ElementName=FourierChart, Path=SecondaryAxis}" Stroke="Green" StrokeThickness="1" />
                <syncfusion:LineSeries ItemsSource="{Binding ThresholdUpperLine}" XBindingPath="X" YBindingPath="Y" YAxis="{Binding ElementName=FourierChart, Path=SecondaryAxis}" Stroke="Orange" StrokeThickness="1" />

            </syncfusion:SfChart>
            <Grid Grid.Row="1" Grid.Column="1">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition />
                </Grid.RowDefinitions>
                <Grid Grid.Row="0" Margin="0,0,0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition />
                    </Grid.ColumnDefinitions>
                    <GroupBox Grid.Column="0" Header="Curve" 
                              Margin="2">
                        <Grid Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <syncfusion:SfRadialSlider Grid.Row="0" Grid.Column="0"  Width="80" Height="80"
                                                   Minimum="0" Maximum="15"
                                                   Value="{Binding Harmonics, Mode=TwoWay}"
                                                   OuterRimRadiusFactor="0.6"
                                                   OuterRimStroke="#444"
                                                   OuterRimStrokeThickness="3"
                                                   InnerRimFill="#444"
                                                   InnerRimStroke="#444"
                                                   InnerRimRadiusFactor="0.4"
                                                   StartAngle="135" EndAngle="405"
                                                   TickFrequency="2"
                                                   TickVisibility="Visible"
                                                   TickRadiusFactor="0.6" PointerRadiusFactor="0.5" 
                                                   LabelVisibility="Hidden">
                                <TextBlock Text="{Binding Harmonics, Mode=OneWay}" />
                            </syncfusion:SfRadialSlider>

                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Harmonics" 
                                   Style="{StaticResource RadialSliderLabel}"/>

                            <syncfusion:SfRadialSlider Grid.Row="0" Grid.Column="1"  Width="80" Height="80"
                                                   Minimum="1" Maximum="8"
                                                   Value="{Binding Periods, Mode=TwoWay}"
                                                   OuterRimRadiusFactor="0.6"
                                                   OuterRimStroke="#444"
                                                   OuterRimStrokeThickness="3"
                                                   InnerRimFill="#444"
                                                   InnerRimStroke="#444"
                                                   InnerRimRadiusFactor="0.4"
                                                   StartAngle="135" EndAngle="405"
                                                   TickFrequency="1"
                                                   TickVisibility="Visible"
                                                   TickRadiusFactor="0.6" PointerRadiusFactor="0.5" 
                                                   LabelVisibility="Hidden">
                                <TextBlock Text="{Binding Periods, Mode=OneWay}" />
                            </syncfusion:SfRadialSlider>

                            <TextBlock Grid.Row="1" Grid.Column="1" Text="Periods" 
                                   Style="{StaticResource RadialSliderLabel}"/>

                        </Grid>
                    </GroupBox>
                    <GroupBox Grid.Column="1" Header="MIDI Range"
                              Margin="2">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <syncfusion:SfRadialSlider Grid.Row="0" Grid.Column="0"  Width="80" Height="80"
                                                   Minimum="0" Maximum="127"
                                                   Value="{Binding MidiMin, Mode=TwoWay}"
                                                   OuterRimRadiusFactor="0.6"
                                                   OuterRimStroke="#444"
                                                   OuterRimStrokeThickness="3"
                                                   InnerRimFill="#444"
                                                   InnerRimStroke="#444"
                                                   InnerRimRadiusFactor="0.4"
                                                   StartAngle="135" EndAngle="405"
                                                   TickFrequency="16"
                                                   TickVisibility="Visible"
                                                   TickRadiusFactor="0.6" PointerRadiusFactor="0.5" 
                                                   LabelVisibility="Hidden">
                                <TextBlock Text="{Binding MidiMin, Mode=OneWay, StringFormat=N0}" />
                            </syncfusion:SfRadialSlider>

                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Lower" 
                                   Style="{StaticResource RadialSliderLabel}"/>

                            <syncfusion:SfRadialSlider Grid.Row="0" Grid.Column="1"  Width="80" Height="80"
                                                   Minimum="0" Maximum="127"
                                                   Value="{Binding MidiMax, Mode=TwoWay}"
                                                   OuterRimRadiusFactor="0.6"
                                                   OuterRimStroke="#444"
                                                   OuterRimStrokeThickness="3"
                                                   InnerRimFill="#444"
                                                   InnerRimStroke="#444"
                                                   InnerRimRadiusFactor="0.4"
                                                   StartAngle="135" EndAngle="405"
                                                   TickFrequency="16"
                                                   TickVisibility="Visible"
                                                   TickRadiusFactor="0.6" PointerRadiusFactor="0.5" 
                                                   LabelVisibility="Hidden">
                                <TextBlock Text="{Binding MidiMax, Mode=OneWay, StringFormat=N0}" />
                            </syncfusion:SfRadialSlider>

                            <TextBlock Grid.Row="1" Grid.Column="1" Text="Upper" 
                                   Style="{StaticResource RadialSliderLabel}"/>

                        </Grid>
                    </GroupBox>
                    <GroupBox Grid.Column="2" Header="MIDI Threshold"
                              Margin="2">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <syncfusion:SfRadialSlider Grid.Row="0" Grid.Column="0"  Width="80" Height="80"
                                                   Minimum="0" Maximum="127"
                                                   Value="{Binding LowerThreshold, Mode=TwoWay}"
                                                   OuterRimRadiusFactor="0.6"
                                                   OuterRimStroke="#444"
                                                   OuterRimStrokeThickness="3"
                                                   InnerRimFill="#444"
                                                   InnerRimStroke="#444"
                                                   InnerRimRadiusFactor="0.4"
                                                   StartAngle="135" EndAngle="405"
                                                   TickFrequency="16"
                                                   TickVisibility="Visible"
                                                   TickRadiusFactor="0.6" PointerRadiusFactor="0.5" 
                                                   LabelVisibility="Hidden">
                                <TextBlock Text="{Binding LowerThreshold, Mode=OneWay, StringFormat=N0}" />
                            </syncfusion:SfRadialSlider>

                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Lower" 
                                   Style="{StaticResource RadialSliderLabel}"/>

                            <syncfusion:SfRadialSlider Grid.Row="0" Grid.Column="1"  Width="80" Height="80"
                                                   Minimum="0" Maximum="127"
                                                   Value="{Binding UpperThreshold, Mode=TwoWay}"
                                                   OuterRimRadiusFactor="0.6"
                                                   OuterRimStroke="#444"
                                                   OuterRimStrokeThickness="3"
                                                   InnerRimFill="#444"
                                                   InnerRimStroke="#444"
                                                   InnerRimRadiusFactor="0.4"
                                                   StartAngle="135" EndAngle="405"
                                                   TickFrequency="16"
                                                   TickVisibility="Visible"
                                                   TickRadiusFactor="0.6" PointerRadiusFactor="0.5" 
                                                   LabelVisibility="Hidden">
                                <TextBlock Text="{Binding UpperThreshold, Mode=OneWay, StringFormat=N0}" />
                            </syncfusion:SfRadialSlider>

                            <TextBlock Grid.Row="1" Grid.Column="1" Text="Upper" 
                                   Style="{StaticResource RadialSliderLabel}"/>

                        </Grid>
                    </GroupBox>
                </Grid>
                <GroupBox Grid.Row="1" Header="Fourier Coefficients" Margin="2">
                    <ScrollViewer HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto">
                        <ItemsControl ItemsSource="{Binding FourierCoeffizients}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel Orientation="Horizontal" 
                                               Width="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=ItemsControl}}"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                        </ItemsControl>
                    </ScrollViewer>
                </GroupBox>
            </Grid>

        </Grid>
    </DataTemplate>
</ResourceDictionary>